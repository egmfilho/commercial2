md-toolbar.md-menu-toolbar.order-toolbar.md-whiteframe-2dp
	div(layout='row')
		md-toolbar-filler(layout layout-align='center center')
			md-icon(md-font-set='material-icons') description

		div
			.md-toolbar-tools
				h1 Novo Orçamento
			md-menu-bar.order-menu-bar
				md-menu
					button(ng-click='$mdMenu.open()') Arquivo
					md-menu-content
						md-menu-item
							md-button(ng-click='order.showDialog()')
								md-icon(md-font-set='material-icons') insert_drive_file
								|  Novo
						md-menu-item
							md-button(ng-click='')
								md-icon(md-font-set='material-icons') restore_page
								|  Recuperar
						md-menu-divider
						md-menu-item
							md-button(ng-click='')
								md-icon(md-font-set='material-icons') save
								|  Salvar
						md-menu-item
							md-button(ng-click='' disabled)
								md-icon(md-font-set='material-icons') cloud_upload
								|  Exportar
						md-menu-divider
						md-menu-item
							md-button(ng-click='order.savePDF("http://github.com")' disabled)
								md-icon(md-font-set='material-icons') print
								|  Imprimir
						md-menu-item
							md-button(ng-click='' disabled)
								md-icon(md-font-set='material-icons') mail
								|  Enviar por email
						md-menu-divider
						md-menu-item
							md-button(ng-click='' disabled)
								md-icon(md-font-set='material-icons') delete_forever
								|  Excluir
				md-menu
					button(ng-click='$mdMenu.open()') Editar
					md-menu-content
						md-menu-item
							md-button(ng-click='')
								| Vendedor
				md-menu
					button(ng-click='$mdMenu.open()') Ver
					md-menu-content
						md-menu-item
							md-button(ng-click='')
								| Vendedor
				md-menu
					button(ng-click='$mdMenu.open()') Ajuda
					md-menu-content
						md-menu-item
							md-button(ng-click='toast("Tooooastyyyy bolado!", "success")')
								| Sobre

md-content#order(flex layout-padding style='background-color: #d9d9d9')

	.order-container
		//- Vendedor
		section(name='seller')
			md-card
				md-card-header
					md-card-header-text
						span.md-title Vendedor
						span.md-subhead Informe o vendedor
				md-card-content
					div(layout-gt-xs='row')
						md-input-container
							label Código
							input(ng-value='order.budget.seller.person_code' 
									blur-to='order.budget.seller.person_code'
									keys-shortcuts 
									enter='order.getSellerByCode($event.target.value)' 
									shift-enter='order.scrollTo("section[name=\'customer\']")')
						md-autocomplete(flex 
										md-input-name='autocompleteSeller'
										md-no-cache='false'
										md-escape-options='none'
										md-selected-item='order.internal.tempSeller'
										md-search-text='sellerQuery'
										md-selected-item-change='item.person_code && order.getSellerByCode(item.person_code)'
										md-items='item in order.getSellerByName(sellerQuery)'
										md-item-text='item.person_name'
										md-min-length='3'
										md-require-match='true'
										md-floating-label='Nome'
										ng-blur='order.internal.blurSeller()')
							md-item-template
								div(md-highlight-text='sellerQuery' style='line-height: 2') {{item.person_name}}
								div(style='font-size: 11px;line-height: 1')
									| Código: 
									| {{item.person_code}}

					pre(ng-if='debug')
						| {{order.budget.seller | json}}

		//- Produtos					
		section(name='products')
			md-card
				md-card-header
					md-card-header-text
						span.md-title Produtos
						span.md-subhead Adicione ou remova produtos
				md-card-content
					div(layout-gt-xs='row')
						md-input-container(flex='25')
							label Código
							input(name='product-code' ng-value='order.internal.tempItem.product.product_code'
									blur-to='order.internal.tempItem.product.product_code' 
									keys-shortcuts enter='order.getProductByCode($event.target.value)')
						
						md-autocomplete(flex='75' keys-shortcuts enter='teste()'
										md-input-name='autocompleteProduct'
										md-no-cache='false'
										md-escape-options='none'
										md-selected-item='order.internal.tempProduct'
										md-search-text='productQuery'
										md-selected-item-change='item.product_code && order.getProductByCode(item.product_code)'
										md-items='item in order.getProductByName(productQuery)'
										md-item-text='item.product_name'
										md-min-length='3'
										md-require-match='true'
										md-floating-label='Nome'
										ng-blur='order.internal.blurItem()')
							md-item-template
								div(md-highlight-text='customerQuery' style='line-height: 2') {{item.product_name}}
								div(layout='row' style='color: #888')
									div(style='font-size: 11px;line-height: 1')
										| Código: 
										| {{item.product_code}}
									div(flex='5')
									div(style='font-size: 11px;line-height: 1')
										| Qtd em estoque: 
										| {{item.stock.product_stock}}
									div(flex='5')
									div(style='font-size: 11px;line-height: 1')
										| Preço: 
										| {{item.price.price_value | currency: 'R$ '}}

						md-input-container(flex='25')
							label 
								i.fa.fa-lock &nbsp;
								| Valor unitário
							input(ng-value='order.internal.tempItem.product.price.price_value | currency:"R$ "' tabindex='-1' readonly)
					
					div(layout='row')
						md-input-container(flex='25')
							label 
								//- i.fa.fa-lock(ng-if='!order.internal.tempItem.product.product_code') &nbsp;
								| Quantidade
							input(name='amount' ng-model='order.internal.tempItem.order_item_amount'
									keys-shortcuts enter='order.focusOn("input[name=\'al-discount\']")'
									currency number-only)
						
						md-input-container(flex='25')
							label 
								//- i.fa.fa-lock(ng-if='!order.internal.tempItem.product.product_code') &nbsp;
								| Desconto %
							input(name='al-discount' ng-model='order.internal.tempItem.order_item_al_discount' 
									ng-model-options="{ updateOn: 'default blur' }"
									ng-blur='order.internal.tempItem.setAlDiscount(order.internal.tempItem.order_item_al_discount)'
									currency number-only
									keys-shortcuts enter='order.focusOn("input[name=\'vl-discount\']")')
						
						md-input-container(flex='25')
							label 
								//- i.fa.fa-lock(ng-if='!order.internal.tempItem.product.product_code') &nbsp;
								| Desconto R$
							input(name='vl-discount' ng-model='order.internal.tempItem.order_item_vl_discount' 
									ng-model-options="{ updateOn: 'default blur' }"
									ng-blur='order.internal.tempItem.setVlDiscount(order.internal.tempItem.order_item_vl_discount)'
									currency number-only
									keys-shortcuts enter='order.addItem()')
						
						md-input-container(flex='25')
							label 
								i.fa.fa-lock &nbsp;
								| Total
							input(ng-value='order.internal.tempItem.getValueTotal() | currency:"R$ "' tabindex='-1' readonly)

					pre(ng-if='debug')
						| {{order.internal.tempItem | json}}

					div(layout='column' style='margin-top: 45px')
						.products-table-header-container
							table.products-table
								thead
									tr
										th &nbsp; PRODUTO
										th UND
										th QTD
										th VL UNIT
										th DESC %
										th DESC R$
										th VALOR TOTAL
										th &nbsp;
						.container-table
							table.products-table
								tbody
									tr(ng-repeat='i in order.budget.items' layout='row')
										td {{i.product.product_code}} - {{i.product.product_name}}
										td {{i.product.unit.unit_initials}}
										td {{i.order_item_amount}}
										td {{i.order_item_value | currency}}
										td {{i.order_item_al_discount | currency:''}}%
										td {{i.order_item_vl_discount | currency}}
										td {{i.getValueTotal() | currency}}
										td
											md-menu
												md-button.md-icon-button(tabindex='-1' ng-click='order.editItemMenu($mdMenu, $event)')
													md-icon(md-font-icon='fa fa-ellipsis-v')
												md-menu-content(width='2')
													md-menu-item
														md-button(ng-click='') 
															md-icon(md-font-set='material-icons' md-menu-align-target) create
															|  Editar
													md-menu-divider
													md-menu-item
														md-button(ng-click='order.removeItem(i)')
															md-icon(md-font-set='material-icons' md-menu-align-target) delete_forever
															|  Excluir

					div(layout='row' style='margin-top: 30px')
						div(flex)
						md-input-container.large-input(flex='15')
							label Desconto %
							input(tabindex='-1' readonly value='0,00%')
						md-input-container.large-input(flex='15')
							label Desconto R$
							input(tabindex='-1' readonly value='R$ 0,00')
						md-input-container.large-input(flex='15')
							label Total
							input(tabindex='-1' readonly value='R$ 0,00')

		//- Cliente
		section(name='customer')
			md-card(layout-align='center')
				md-card-header
					md-card-header-text
						span.md-title Cliente
						span.md-subhead Informe o cliente e seu endereço de entrega
				
				md-card-content
					div(layout-gt-xs='row' layout-wrap)
						md-input-container(flex='25')
							label Código
							input(ng-value='order.budget.customer.person_code' 
									blur-to='order.budget.customer.person_code'
									keys-shortcuts 
									enter='order.getCustomerByCode($event.target.value)' 
									shift-enter='')
						md-autocomplete(flex='75'
										md-input-name='autocompleteCustomer'
										md-no-cache='false'
										md-escape-options='none'
										md-selected-item='order.internal.tempCustomer'
										md-search-text='customerQuery'
										md-selected-item-change='item.person_code && order.getCustomerByCode(item.person_code)'
										md-items='item in order.getCustomerByName(customerQuery)'
										md-item-text='item.person_name'
										md-min-length='3'
										md-require-match='true'
										md-floating-label='Nome'
										ng-blur='order.internal.blurCustomer()')
							md-item-template
								div(md-highlight-text='customerQuery' style='line-height: 2') {{item.person_name}}
								div(style='font-size: 11px;line-height: 1')
									| Código: 
									| {{item.person_code}}
						
						md-input-container.md-icon-float(flex='25')
							label
								span
									i.fa.fa-lock &nbsp;
									span Tipo
							input(ng-value='order.budget.customer.getType()' readonly)
						
						md-input-container(flex='25')
							label 
								i.fa.fa-lock &nbsp;
								| CPF
							input(ng-value='order.budget.customer.person_cpf' readonly)

						md-input-container(flex='25')
							label 
								i.fa.fa-lock &nbsp;
								| CNPJ
							input(ng-value='order.budget.customer.person_cnpj' readonly)

						md-input-container(flex='25')
							label 
								i.fa.fa-lock &nbsp;
								| Inscrição Estadual
							input(ng-value='order.budget.customer.getMainAddress().person_address_ie' readonly)


					div(layout='column' style='margin-top: 30px')
						md-tabs(md-selected='order.internal.address.selectedTabIndex' md-border-bottom flex)
							md-tab(label='Endereço de entrega' ng-disabled='!order.budget.customer.person_id')
								md-content(layout='row' layout-wrap style='padding: 0' layout-fill)
									div(flex layout='column' layout-align='center center' 
											ng-if='order.budget.customer.person_id && order.budget.customer.person_address == 0')
										h1.inner-text Nenhum endereço cadastrado.
										md-button.md-raised.md-primary(ng-click='order.internal.address.selectedTabIndex = 1') 
											| &nbsp; Cadastrar &nbsp;
									div(flex='33' 
										ng-repeat='a in order.budget.customer.person_address track by $index'
										ng-if='order.budget.customer.person_address.length > 0')
										md-card(ng-class='{"active": a.person_address_code == order.budget.deliveryAddressId}')
											md-card-content(layout='column' layout-fill) 
												div(flex='15' layout='row')
													b Cód: {{a.person_address_code}}
														span(ng-if='a.person_address_main != "N"') &nbsp;(Principal)
													div(flex)
													.label.label-success(ng-if='a.person_address_code == order.budget.deliveryAddressId') 
														i.fa.fa-map-marker &nbsp;
														| Selecionado
													.label.label-error(ng-if='a.person_address_active == "N"') 
														| Inativo
												div(flex layout='row' layout-align='start center')
													p.text-primary
														| {{a.toString()}}
												div(flex='30' layout='row' layout-align='end end')
													md-button.md-icon-button.md-raised.md-primary(
															ng-click='order.budget.setDeliveryAddressId(a.person_address_code)' 
															ng-disabled='a.person_address_code == order.budget.deliveryAddressId')
														md-icon(md-font-icon='fa fa-check')

							md-tab(label='Novo endereço' ng-disabled='!order.budget.customer.person_id')
								md-content(ng-controller='NewAddressCtrl as address')
									form(layout='row' name='newAddressForm')
										md-card.new-address-card(flex)
											md-card-content(layout='row' layout-wrap)
												md-input-container(flex='15')
													label 
														| CEP
													input(ng-model='address.newAddress.person_address_cep' ui-mask='99999-999')

												md-input-container(flex='10')
													label 
														| Tipo
													input(ng-model='address.newAddress.person_address_type')

												md-input-container(flex='60')
													label 
														| Logradouro
													input(ng-model='address.newAddress.person_address_public_place')

												md-input-container(flex='15')
													label 
														| Número
													input(ng-model='address.newAddress.person_address_number')

												md-input-container(flex='35')
													label 
														| Bairro
													md-select(ng-model='address.newAddress.district_id'
															data-md-container-class='query-select-container')
														md-select-header.select-header
															input.md-text(ng-model='address.queryDistrict' 
																	type='search' placeholder='Digite o nome do bairro'
																	ng-keydown="address.updateSearch($event)")
														md-opt-group(label='Bairros')
															md-option(ng-value='d.district_id' 
																	ng-repeat='d in address.queryDistrictResult')
																| {{d.district_name}}

												md-input-container(flex='35')
													label 
														| Cidade
													md-select(ng-model='address.newAddress.city_id'
															data-md-container-class='query-select-container')
														md-select-header.select-header
															input.md-text(ng-model='address.queryCity' 
																	type='search' placeholder='Digite o nome da cidade'
																	ng-keydown="address.updateSearch($event)")
														md-opt-group(label='Cidades')
															md-option(ng-value='c.city_id' 
																	ng-repeat='c in address.queryCityResult')
																| {{c.city_name}} - {{c.uf_id}}

												md-input-container(flex='30')
													label 
														| Inscrição Estadual
													input(ng-model='ie')

												.offset-top-30(layout='row' layout-fill)
													md-input-container(flex='50')
														md-switch(name='delivery' ng-true-value='"Y"' ng-false-value='"N"'
																ng-model='address.newAddress.person_address_delivery')
															| Endereço de Entrega

													md-button.md-raised(flex='25' ng-click='address.clear()')
														| Limpar

													md-button.md-raised.md-primary(flex='25' ng-click='address.submit()')
														| Cadastrar

						.delivery-address
							md-toolbar
								.md-toolbar-tools
									i.fa.fa-2x.fa-truck &nbsp;
									p(ng-if='!order.budget.deliveryAddressId') Nenhum endereço informado!
									div(layout='column' ng-if='order.budget.deliveryAddressId') 
										span(style='font-size: 11px')
											| Código: {{order.budget.getDeliveryAddress().person_address_code}}
										span {{order.budget.getDeliveryAddress().toString()}}
					
					pre(ng-if='debug')
						| {{order.budget.customer | json}}

		//- Observações
		section(name='notes')
			md-card(layout-align='center')
				md-card-header
					md-card-header-text
						span.md-title Observações
						span.md-subhead Aqui você pode inserir informações adicionais sobre o orçamento
				md-card-content
					div(layout-gt-xs='row')
						md-input-container(flex)
							label Observações
							textarea(ng-model='observacoes' md-maxlength='150' rows='3')